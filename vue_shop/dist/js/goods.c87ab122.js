"use strict";(self["webpackChunkvue_shop"]=self["webpackChunkvue_shop"]||[]).push([[795],{7638:function(e,t,a){a.r(t),a.d(t,{default:function(){return d}});var s=function(){var e=this,t=e._self._c;return t("div",[t("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[t("el-breadcrumb-item",{attrs:{to:{path:"/home"}}},[e._v("首页")]),t("el-breadcrumb-item",[e._v("商品管理")]),t("el-breadcrumb-item",[e._v("添加商品")])],1),t("el-card",[t("el-alert",{attrs:{title:"添加商品信息",type:"info",center:"",closable:!1,"show-icon":""}}),t("el-steps",{attrs:{"align-center":"",space:200,active:+e.activeIndex,"finish-status":"success"}},[t("el-step",{attrs:{title:"基本信息"}}),t("el-step",{attrs:{title:"商品参数"}}),t("el-step",{attrs:{title:"商品属性"}}),t("el-step",{attrs:{title:"商品图片"}}),t("el-step",{attrs:{title:"商品内容"}}),t("el-step",{attrs:{title:"完成"}})],1),t("el-form",{ref:"addFormRef",attrs:{"status-icon":"","label-position":"top",model:e.addForm,rules:e.addFormRules,"label-width":"100px"}},[t("el-tabs",{attrs:{"before-leave":e.beforeTabLeave,"tab-position":"left"},on:{"tab-click":e.tabClicked},model:{value:e.activeIndex,callback:function(t){e.activeIndex=t},expression:"activeIndex"}},[t("el-tab-pane",{attrs:{label:"基本信息",name:"0"}},[t("el-form-item",{attrs:{label:"商品名称",prop:"goods_name"}},[t("el-input",{model:{value:e.addForm.goods_name,callback:function(t){e.$set(e.addForm,"goods_name",t)},expression:"addForm.goods_name"}})],1),t("el-form-item",{attrs:{label:"商品价格",prop:"goods_price"}},[t("el-input",{attrs:{type:"number"},model:{value:e.addForm.goods_price,callback:function(t){e.$set(e.addForm,"goods_price",t)},expression:"addForm.goods_price"}})],1),t("el-form-item",{attrs:{label:"商品重量",prop:"goods_weight"}},[t("el-input",{attrs:{type:"number"},model:{value:e.addForm.goods_weight,callback:function(t){e.$set(e.addForm,"goods_weight",t)},expression:"addForm.goods_weight"}})],1),t("el-form-item",{attrs:{label:"商品数量",prop:"goods_number"}},[t("el-input",{attrs:{type:"number"},model:{value:e.addForm.goods_number,callback:function(t){e.$set(e.addForm,"goods_number",t)},expression:"addForm.goods_number"}})],1),t("el-form-item",{attrs:{label:"商品分类",prop:"goods_cat"}},[t("el-cascader",{attrs:{clearable:"",options:e.cateList,props:{expandTrigger:"hover",...e.cateProp}},on:{change:e.handleChange},model:{value:e.addForm.goods_cat,callback:function(t){e.$set(e.addForm,"goods_cat",t)},expression:"addForm.goods_cat"}})],1)],1),t("el-tab-pane",{attrs:{label:"商品参数",name:"1"}},e._l(e.manyTableData,(function(a){return t("el-form-item",{key:a.attr_id,attrs:{label:a.attr_name}},[t("el-checkbox-group",{model:{value:a.attr_vals,callback:function(t){e.$set(a,"attr_vals",t)},expression:"item.attr_vals"}},e._l(a.attr_vals,(function(e,a){return t("el-checkbox",{key:a,attrs:{border:"",label:e}})})),1)],1)})),1),t("el-tab-pane",{attrs:{label:"商品属性",name:"2"}},e._l(e.onlyTableDate,(function(a){return t("el-form-item",{key:a.attr_id,attrs:{label:a.attr_name}},[t("el-input",{model:{value:a.attr_vals,callback:function(t){e.$set(a,"attr_vals",t)},expression:"item.attr_vals"}})],1)})),1),t("el-tab-pane",{attrs:{label:"商品图片",name:"3"}},[t("el-upload",{attrs:{"on-success":e.handleSuccess,headers:e.headers,action:"http://127.0.0.1:8888/api/private/v1/upload","on-preview":e.handlePreview,"on-remove":e.handleRemove,"list-type":"picture"}},[t("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")])],1)],1),t("el-tab-pane",{attrs:{label:"商品内容",name:"4"}},[t("quill-editor",{model:{value:e.addForm.goods_introduce,callback:function(t){e.$set(e.addForm,"goods_introduce",t)},expression:"addForm.goods_introduce"}}),t("el-button",{staticClass:"btn_add",attrs:{type:"primary"},on:{click:e.add}},[e._v("添加商品")])],1)],1)],1)],1),t("el-dialog",{attrs:{title:"图片预览",visible:e.previewDialogVisible},on:{"update:visible":function(t){e.previewDialogVisible=t}}},[t("img",{staticClass:"previewImg",attrs:{src:e.previewPath,alt:""}})])],1)},r=[],i={name:"AddGood",data(){return{activeIndex:"0",addForm:{goods_name:"",goods_price:0,goods_weight:0,goods_number:0,goods_cat:[],pics:[],goods_introduce:"",attrs:[]},addFormRules:{goods_name:[{trigger:"blur",required:!0,message:"请输入商品名称"}],goods_price:[{trigger:"blur",required:!0,message:"请输入商品价格"}],goods_weight:[{trigger:"blur",required:!0,message:"请输入商品重量"}],goods_number:[{trigger:"blur",required:!0,message:"请输入商品数量"}],goods_cat:[{trigger:"change",required:!0,message:"请选择商品所属的三级分类"}]},cateList:[],cateProp:{value:"cat_id",label:"cat_name",children:"children"},manyTableData:[],onlyTableDate:[],headers:{Authorization:sessionStorage.getItem("token")},previewPath:"",previewDialogVisible:!1}},computed:{cateId(){return 3===this.addForm.goods_cat.length?this.addForm.goods_cat[2]:null}},methods:{async getCateList(){const{data:e}=await this.$http.get("categories");if(200!==e.meta.status)return this.$message.error("获取分类数据失败");this.cateList=e.data},handleChange(){3===this.addForm.goods_cat.length||(this.addForm.goods_cat=[])},beforeTabLeave(e,t){if("0"===t&&3!==this.addForm.goods_cat.length)return this.$message.error("请先选择商品分类"),!1},async tabClicked(){if("1"===this.activeIndex){const{data:e}=await this.$http.get(`categories/${this.cateId}/attributes`,{params:{sel:"many"}});if(200!==e.meta.status)return this.$message.error("获取动态参数数据失败");e.data.forEach((e=>{e.attr_vals=e.attr_vals?e.attr_vals.split(" "):[]})),this.manyTableData=e.data}else if("2"===this.activeIndex){const{data:e}=await this.$http.get(`categories/${this.cateId}/attributes`,{params:{sel:"only"}});if(200!==e.meta.status)return this.$message.error("获取动态参数数据失败");this.onlyTableDate=e.data}},handlePreview(e){this.previewPath=e.response.data.url,this.previewDialogVisible=!0},handleRemove(e){const t=e.response.data.tmp_path;this.addForm.pics=this.addForm.pics.filter((e=>e.pic!==t))},handleSuccess(e){const t={pic:e.data.tmp_path};this.addForm.pics.push(t)},add(){this.$refs.addFormRef.validate((async e=>{if(!e)return this.$message.error("请填写必要的表单项");this.addForm.goods_cat=this.addForm.goods_cat.join(","),this.manyTableData.forEach((e=>{const t={attr_id:e.attr_id,attr_value:e.attr_vals.join(" ")};this.addForm.attrs.push(t)})),this.onlyTableDate.forEach((e=>{const t={attr_id:e.attr_id,attr_value:e.attr_vals};this.addForm.attrs.push(t)}));const{data:t}=await this.$http.post("goods",this.addForm);if(201!==t.meta.status)return this.$message.error("添加商品失败");this.$message.success("添加商品成功"),this.$router.push("/home/goods")}))}},created(){this.getCateList()},beforeRouteEnter(e,t,a){a((e=>{sessionStorage.setItem("activePath","goods"),e.$store.dispatch("saveNavStatus","goods")}))}},o=i,l=a(1001),n=(0,l.Z)(o,s,r,!1,null,"85776630",null),d=n.exports},4137:function(e,t,a){a.r(t),a.d(t,{default:function(){return d}});var s=function(){var e=this,t=e._self._c;return t("div",[t("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[t("el-breadcrumb-item",{attrs:{to:{path:"/home"}}},[e._v("首页")]),t("el-breadcrumb-item",[e._v("商品管理")]),t("el-breadcrumb-item",[e._v("商品分类")])],1),t("el-card",[t("el-row",[t("el-col",[t("el-button",{attrs:{type:"primary"},on:{click:e.showAddCateDialog}},[e._v("添加分类")])],1)],1),t("tree-table",{attrs:{data:e.cateList,columns:e.columns,border:"","show-row-hover":!1,"show-index":!0,"expand-type":!1,"index-text":"#","selection-type":!1},scopedSlots:e._u([{key:"isValid",fn:function(e){return[e.row.cat_deleted?t("i",{staticClass:"el-icon-error",staticStyle:{color:"red"}}):t("i",{staticClass:"el-icon-success",staticStyle:{color:"lightgreen"}})]}},{key:"sort",fn:function(a){return[0===a.row.cat_level?t("el-tag",{attrs:{size:"mini"}},[e._v("一级")]):1===a.row.cat_level?t("el-tag",{attrs:{size:"mini",type:"success"}},[e._v("二级")]):2===a.row.cat_level?t("el-tag",{attrs:{size:"mini",type:"warning"}},[e._v("三级")]):e._e()]}},{key:"operation",fn:function(a){return[t("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-edit"},on:{click:function(t){return e.showEditCateDialog(a.row)}}},[e._v("编辑")]),t("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-delete"},on:{click:function(t){return e.deleteCate(a.row.cat_id)}}},[e._v("删除")])]}}])}),t("el-pagination",{attrs:{"page-sizes":[3,5,10,15],"current-page":e.queryInfo.pagenum,"page-size":e.queryInfo.pagesize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})],1),t("el-dialog",{attrs:{title:"添加分类",visible:e.addCateDialogVisible},on:{"update:visible":function(t){e.addCateDialogVisible=t},close:e.addCateDialogClosed}},[t("el-form",{ref:"addCateFormRef",attrs:{"status-icon":"",model:e.addCateForm,rules:e.addCateFormRules,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"分类名称",prop:"cat_name"}},[t("el-input",{model:{value:e.addCateForm.cat_name,callback:function(t){e.$set(e.addCateForm,"cat_name",t)},expression:"addCateForm.cat_name"}})],1),t("el-form-item",{attrs:{label:"父级分类"}},[t("el-cascader",{attrs:{props:e.cascaderProps,options:e.parentCateList,clearable:""},on:{change:e.parentCateChanged},model:{value:e.selectedKeys,callback:function(t){e.selectedKeys=t},expression:"selectedKeys"}})],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.addCateDialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.addCate}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"修改分类",visible:e.editCateDialogVisible},on:{"update:visible":function(t){e.editCateDialogVisible=t}}},[t("el-form",{ref:"editCateFormRef",attrs:{"status-icon":"",model:e.editCateForm,rules:e.editCateFormRules,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"分类名称",prop:"cat_name"}},[t("el-input",{model:{value:e.editCateForm.cat_name,callback:function(t){e.$set(e.editCateForm,"cat_name",t)},expression:"editCateForm.cat_name"}})],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.editCateDialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.editCate}},[e._v("确 定")])],1)],1)],1)},r=[],i={name:"Categories",data(){return{cateList:[],queryInfo:{type:3,pagenum:1,pagesize:5},total:0,columns:[{label:"分类名称",prop:"cat_name"},{label:"是否有效",type:"template",template:"isValid"},{label:"排序",type:"template",template:"sort"},{label:"操作",type:"template",template:"operation"}],addCateDialogVisible:!1,addCateForm:{cat_pid:0,cat_name:"",cat_level:0},selectedKeys:[],addCateFormRules:{cat_name:[{trigger:"blur",required:!0,message:"请输入分类名称"}]},parentCateList:[],cascaderProps:{expandTrigger:"hover",label:"cat_name",value:"cat_id",children:"children",checkStrictly:!0},editCateDialogVisible:!1,editCateForm:{cat_name:""},editCateFormRules:{cat_name:[{trigger:"blur",required:!0,message:"请输入分类名称"}]},selectedCatId:0}},methods:{async getCateList(){const{data:e}=await this.$http.get("categories",{params:this.queryInfo});if(200!==e.meta.status)return this.$message.error("获取分类数据失败");this.cateList=e.data.result,this.total=e.data.total},handleSizeChange(e){this.queryInfo.pagesize=e,this.getCateList()},handleCurrentChange(e){this.queryInfo.pagenum=e,this.getCateList()},async getParentCateList(){const{data:e}=await this.$http.get("categories",{params:{type:2}});if(200!==e.meta.status)return this.$message.error("获取父级分类数据失败");this.parentCateList=e.data},showAddCateDialog(){this.getParentCateList(),this.addCateDialogVisible=!0},parentCateChanged(){0===this.selectedKeys.length?(this.addCateForm.cat_pid=0,this.addCateForm.cat_level=0):this.selectedKeys.length>0&&(this.addCateForm.cat_pid=this.selectedKeys[this.selectedKeys.length-1],this.addCateForm.cat_level=this.selectedKeys.length)},addCateDialogClosed(){this.$refs.addCateFormRef.resetFields(),this.selectedKeys=[],this.addCateForm.cat_level=0,this.addCateForm.cat_pid=0},addCate(){this.$refs.addCateFormRef.validate((async e=>{if(!e)return;const{data:t}=await this.$http.post("categories",this.addCateForm);if(201!==t.meta.status)return this.$message.error("添加分类失败");this.$message.success("添加分类成功"),this.getCateList(),this.addCateDialogVisible=!1}))},showEditCateDialog(e){this.selectedCatId=e.cat_id,this.editCateForm.cat_name=e.cat_name,this.editCateDialogVisible=!0},editCate(){this.$refs.editCateFormRef.validate((async e=>{if(!e)return;const{data:t}=await this.$http.put("categories/"+this.selectedCatId,this.editCateForm);if(200!==t.meta.status)return this.$message.error("修改分类失败");this.$message.success("修改分类成功"),this.getCateList(),this.editCateDialogVisible=!1}))},async deleteCate(e){const t=await this.$confirm("此操作将永久删除该分类, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch((e=>e));if("cancel"===t)this.$message.info("已取消删除");else if("confirm"===t){const{data:t}=await this.$http.delete("categories/"+e);if(200!==t.meta.status)return this.$message.error("删除分类失败");this.$message.success("删除分类成功"),this.getCateList()}}},created(){this.getCateList()},beforeRouteEnter(e,t,a){a((e=>{sessionStorage.setItem("activePath","categories"),e.$store.dispatch("saveNavStatus","categories")}))}},o=i,l=a(1001),n=(0,l.Z)(o,s,r,!1,null,"75d8ca78",null),d=n.exports},299:function(e,t,a){a.r(t),a.d(t,{default:function(){return d}});var s=function(){var e=this,t=e._self._c;return t("div",[t("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[t("el-breadcrumb-item",{attrs:{to:{path:"/home"}}},[e._v("首页")]),t("el-breadcrumb-item",[e._v("商品管理")]),t("el-breadcrumb-item",[e._v("商品列表")])],1),t("el-card",[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},[t("el-input",{attrs:{clearable:"",placeholder:"请输入内容"},on:{clear:e.getGoodsList},model:{value:e.queryInfo.query,callback:function(t){e.$set(e.queryInfo,"query",t)},expression:"queryInfo.query"}},[t("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.getGoodsList},slot:"append"})],1)],1),t("el-col",{attrs:{span:4}},[t("el-button",{attrs:{type:"primary"},on:{click:e.goAddPage}},[e._v("添加商品")])],1)],1),t("el-table",{attrs:{data:e.goodsList,border:"",stripe:""}},[t("el-table-column",{attrs:{label:"#",type:"index"}}),t("el-table-column",{attrs:{label:"商品名称",prop:"goods_name"}}),t("el-table-column",{attrs:{width:"95px",label:"商品价格(元)",prop:"goods_price"}}),t("el-table-column",{attrs:{width:"70px",label:"商品重量",prop:"goods_weight"}}),t("el-table-column",{attrs:{width:"140px",label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("formatDate")(t.row.add_time))+" ")]}}])}),t("el-table-column",{attrs:{width:"130px",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-edit"}}),t("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-delete"},on:{click:function(t){return e.deleteGood(a.row.goods_id)}}})]}}])})],1),t("el-pagination",{attrs:{background:"","current-page":e.queryInfo.pagenum,"page-sizes":[5,10,15,20],"page-size":e.queryInfo.pagesize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)},r=[],i={name:"Lists",data(){return{goodsList:[],queryInfo:{query:"",pagenum:1,pagesize:10},total:0}},methods:{async getGoodsList(){const{data:e}=await this.$http.get("goods",{params:this.queryInfo});if(200!==e.meta.status)return this.$message.error("获取商品列表数据失败");this.total=e.data.total,this.goodsList=e.data.goods},handleSizeChange(e){this.queryInfo.pagesize=e,this.getGoodsList()},handleCurrentChange(e){this.queryInfo.pagenum=e,this.getGoodsList()},async deleteGood(e){const t=await this.$confirm("此操作将永久删除该商品, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch((e=>e));if("cancel"===t)this.$message.info("已取消删除");else{const{data:t}=await this.$http.delete("goods/"+e);if(200!==t.meta.status)return this.$message.error("删除商品失败");this.$message.success("删除商品成功"),this.getGoodsList()}},goAddPage(){this.$router.push("/home/addGood")}},created(){this.getGoodsList()},beforeRouteEnter(e,t,a){a((e=>{sessionStorage.setItem("activePath","goods"),e.$store.dispatch("saveNavStatus","goods")}))}},o=i,l=a(1001),n=(0,l.Z)(o,s,r,!1,null,"1fc0ab90",null),d=n.exports},6073:function(e,t,a){a.r(t),a.d(t,{default:function(){return d}});var s=function(){var e=this,t=e._self._c;return t("div",[t("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[t("el-breadcrumb-item",{attrs:{to:{path:"/home"}}},[e._v("首页")]),t("el-breadcrumb-item",[e._v("商品管理")]),t("el-breadcrumb-item",[e._v("分类参数")])],1),t("el-card",[t("el-alert",{attrs:{title:"注意：只允许为第三级分类设置相关参数！",type:"warning","show-icon":"",closable:!1}}),t("el-row",{staticClass:"cascader"},[t("el-col",[t("span",[e._v("选择商品分类：")]),t("el-cascader",{attrs:{options:e.cateList,props:{expandTrigger:"hover",...e.cateProps}},on:{change:e.handleChange},model:{value:e.selectedCateKeys,callback:function(t){e.selectedCateKeys=t},expression:"selectedCateKeys"}})],1)],1),t("el-tabs",{on:{"tab-click":e.handleTabClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:"动态参数",name:"many"}},[t("el-button",{attrs:{type:"primary",size:"mini",disabled:e.isDisabled},on:{click:function(t){e.addParamsDialogVisible=!0}}},[e._v("添加参数")]),"many"===e.activeName?t("el-table",{attrs:{data:e.paramList,border:"",stripe:""}},[t("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-row",[t("el-col",[e._l(a.row.attr_vals,(function(s,r){return t("el-tag",{key:r,attrs:{closable:""},on:{close:function(t){return e.handleTagClosed(r,a.row)}}},[e._v(e._s(s))])})),a.row.inputVisible?t("el-input",{ref:"saveTagInput",staticClass:"input-new-tag",attrs:{size:"small"},on:{blur:function(t){return e.handleInputConfirm(a.row)}},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleInputConfirm(a.row)}},model:{value:a.row.inputValue,callback:function(t){e.$set(a.row,"inputValue",t)},expression:"scope.row.inputValue"}}):t("el-button",{attrs:{size:"small"},on:{click:function(t){return e.showInput(a.row)}}},[e._v("+ New Tag")])],2)],1)]}}],null,!1,1106452167)}),t("el-table-column",{attrs:{type:"index",label:"#"}}),t("el-table-column",{attrs:{label:"参数名称",prop:"attr_name"}}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"primary",icon:"el-icon-edit",size:"mini"},on:{click:function(t){return e.showEditParamsDialog(a.row)}}},[e._v("编辑")]),t("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"mini"},on:{click:function(t){return e.deleteParams(a.row.attr_id)}}},[e._v("删除")])]}}],null,!1,3112539268)})],1):e._e()],1),t("el-tab-pane",{attrs:{label:"静态属性",name:"only"}},[t("el-button",{attrs:{type:"primary",size:"mini",disabled:e.isDisabled},on:{click:function(t){e.addParamsDialogVisible=!0}}},[e._v("添加属性")]),"only"===e.activeName?t("el-table",{attrs:{data:e.paramList,border:"",stripe:""}},[t("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-row",[t("el-col",[e._l(a.row.attr_vals,(function(s,r){return t("el-tag",{key:r,attrs:{closable:""},on:{close:function(t){return e.handleTagClosed(r,a.row)}}},[e._v(e._s(s))])})),a.row.inputVisible?t("el-input",{ref:"saveTagInput",staticClass:"input-new-tag",attrs:{size:"small"},on:{blur:function(t){return e.handleInputConfirm(a.row)}},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleInputConfirm(a.row)}},model:{value:a.row.inputValue,callback:function(t){e.$set(a.row,"inputValue",t)},expression:"scope.row.inputValue"}}):t("el-button",{attrs:{size:"small"},on:{click:function(t){return e.showInput(a.row)}}},[e._v("+ New Tag")])],2)],1)]}}],null,!1,1106452167)}),t("el-table-column",{attrs:{type:"index",label:"#"}}),t("el-table-column",{attrs:{label:"属性名称",prop:"attr_name"}}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"primary",icon:"el-icon-edit",size:"mini"},on:{click:function(t){return e.showEditParamsDialog(a.row)}}},[e._v("编辑")]),t("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"mini"},on:{click:function(t){return e.deleteParams(a.row.attr_id)}}},[e._v("删除")])]}}],null,!1,3112539268)})],1):e._e()],1)],1)],1),t("el-dialog",{attrs:{title:"添加"+e.tileText,visible:e.addParamsDialogVisible},on:{"update:visible":function(t){e.addParamsDialogVisible=t},close:e.addParamsDialogClosed}},[t("el-form",{ref:"addParamsFormRef",attrs:{"status-icon":"",rules:e.addParamsFormRules,model:e.addParamsForm,"label-width":"80px"}},[t("el-form-item",{attrs:{label:e.tileText,prop:"attr_name"}},[t("el-input",{model:{value:e.addParamsForm.attr_name,callback:function(t){e.$set(e.addParamsForm,"attr_name",t)},expression:"addParamsForm.attr_name"}})],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.addParamsDialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.addParams}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"修改"+e.tileText,visible:e.editParamsDialogVisible},on:{"update:visible":function(t){e.editParamsDialogVisible=t},close:e.editParamsDialogClosed}},[t("el-form",{ref:"editParamsFormRef",attrs:{"status-icon":"",rules:e.editParamsFormRules,model:e.editParamsForm,"label-width":"80px"}},[t("el-form-item",{attrs:{label:e.tileText,prop:"attr_name"}},[t("el-input",{model:{value:e.editParamsForm.attr_name,callback:function(t){e.$set(e.editParamsForm,"attr_name",t)},expression:"editParamsForm.attr_name"}})],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.editParamsDialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.editParams}},[e._v("确 定")])],1)],1)],1)},r=[],i={name:"Params",data(){return{cateList:[],selectedCateKeys:[],cateProps:{value:"cat_id",label:"cat_name",children:"children"},activeName:"many",paramList:[],addParamsDialogVisible:!1,editParamsDialogVisible:!1,addParamsForm:{attr_name:""},editParamsForm:{attr_name:""},addParamsFormRules:{attr_name:[{trigger:"blur",required:!0,message:"请输入参数名称"}]},editParamsFormRules:{attr_name:[{trigger:"blur",required:!0,message:"请输入参数名称"}]}}},computed:{isDisabled(){return 3!==this.selectedCateKeys.length},selectedThreeCateId(){return 3===this.selectedCateKeys.length?this.selectedCateKeys[2]:null},tileText(){return"many"===this.activeName?"动态参数":"静态属性"}},methods:{async getCateList(){const{data:e}=await this.$http.get("categories");if(200!==e.meta.status)return this.$message.error("获取分类列表数据失败");this.cateList=e.data},handleChange(){3!==this.selectedCateKeys.length?(this.selectedCateKeys=[],this.paramList=[]):this.getParamList(this.activeName)},async getParamList(e){if(3===this.selectedCateKeys.length){const{data:t}=await this.$http.get(`categories/${this.selectedThreeCateId}/attributes`,{params:{sel:e}});if(200!==t.meta.status)return this.$message.error("获取参数列表失败");t.data.forEach((e=>{e.attr_vals=e.attr_vals?e.attr_vals.split(" "):[],e.inputVisible=!1,e.inputValue=""})),this.paramList=t.data}},handleTabClick(){this.getParamList(this.activeName)},addParamsDialogClosed(){this.$refs.addParamsFormRef.resetFields()},editParamsDialogClosed(){this.$refs.editParamsFormRef.resetFields()},addParams(){this.$refs.addParamsFormRef.validate((async e=>{if(!e)return;const{data:t}=await this.$http.post(`categories/${this.selectedThreeCateId}/attributes`,{attr_name:this.addParamsForm.attr_name,attr_sel:this.activeName});if(201!==t.meta.status)return this.$message.error("添加失败");this.$message.success("添加成功"),this.getParamList(this.activeName),this.addParamsDialogVisible=!1}))},showEditParamsDialog(e){this.editParamsForm.attr_id=e.attr_id,this.editParamsForm.attr_name=e.attr_name,this.editParamsDialogVisible=!0},editParams(){this.$refs.editParamsFormRef.validate((async e=>{if(!e)return;const{data:t}=await this.$http.put(`categories/${this.selectedThreeCateId}/attributes/${this.editParamsForm.attr_id}`,{attr_name:this.editParamsForm.attr_name,attr_sel:this.activeName});if(200!==t.meta.status)return this.$message.error("修改参数失败");this.$message.success("修改参数成功"),this.getParamList(this.activeName),this.editParamsDialogVisible=!1}))},async deleteParams(e){const t=await this.$confirm("此操作将永久删除该参数, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch((e=>e));if("cancel"===t)return this.$message.info("已取消删除");if("confirm"===t){const{data:t}=await this.$http.delete(`categories/${this.selectedThreeCateId}/attributes/${e}`);if(200!==t.meta.status)return this.$message.error("删除参数失败");this.$message.success("删除参数成功"),this.getParamList(this.activeName)}},async saveAttrVals(e){const{data:t}=await this.$http.put(`categories/${this.selectedThreeCateId}/attributes/${e.attr_id}`,{attr_name:e.attr_name,attr_sel:e.attr_sel,attr_vals:e.attr_vals.join(" ")});if(200!==t.meta.status)return this.$message.error("添加参数项失败")},handleInputConfirm(e){if(!e.inputValue.trim())return e.inputValue="",void(e.inputVisible=!1);e.attr_vals.push(e.inputValue.trim()),e.inputValue="",e.inputVisible=!1,this.saveAttrVals(e)},showInput(e){e.inputVisible=!0,this.$nextTick((e=>{this.$refs.saveTagInput.$refs.input.focus()}))},handleTagClosed(e,t){t.attr_vals.splice(e,1),this.saveAttrVals(t)}},created(){this.getCateList()},beforeRouteEnter(e,t,a){a((e=>{sessionStorage.setItem("activePath","params"),e.$store.dispatch("saveNavStatus","params")}))}},o=i,l=a(1001),n=(0,l.Z)(o,s,r,!1,null,"c98482c0",null),d=n.exports}}]);
//# sourceMappingURL=goods.c87ab122.js.map